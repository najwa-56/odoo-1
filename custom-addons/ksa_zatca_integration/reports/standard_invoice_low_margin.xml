<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_tax_low_margin_invoice">
        <t t-foreach="docs" t-as="o">
            <t t-call="web.basic_layout">

                <!-- POS-Style Container -->
                <div dir="ltr">
                    <div class="pos-receipt page_block font" style="text-align: center; padding-bottom: 0px; display: inline-block; overflow: hidden; width: 800px;">

                        <!-- Add Font CSS -->
                        <link rel="stylesheet" href="/ksa_zatca_integration/static/src/css/style.css"/>

                        <!-- Logo -->
                        <t t-if="o.company_id.logo">
                            <img t-attf-src="data:image/*;base64,{{o.company_id.logo}}" style="max-height:100px; max-width:100%; display: block; margin: 0 auto;" alt="Company Logo"/>
                            <br/>
                        </t>
                        <t t-if="not o.company_id.logo">
                            <h2 style="text-align: center;" class="font">
                                <t t-esc="o.company_id.name"/>
                            </h2>
                            <br/>
                        </t>

                        <!-- Invoice Title -->
                        <div class="pos-receipt-contact" style="padding-top: 10px; text-align: center; font-weight: bold; font-size: 13pt;">
                            <span class="arabic"> الفاتورة الضريبية </span>
                        </div>
                        <hr/>

                        <!-- Invoice Info -->
                        <div>
                            <table width="100%" style="font-size: 15pt; border-collapse: collapse;">
                                <tr style="border: 2pt solid black;">
                                    <td class="arabic" style="width:50%; text-align:center;background-color:#ffffff;color:black;">
                                        <span t-field="o.name"/>
                                    </td>
                                    <td class="arabic" style="text-align:right;color:black;background-color:#dddddd;font-weight: bold;">
                                        رقم الفاتورة
                                    </td>
                                </tr>
                                <tr style="border: 2pt solid black;">
                                    <td class="arabic" style="width:50%; text-align:center;">
                                        <span t-field="o.invoice_date"/>
                                    </td>
                                    <td class="arabic" style="text-align:right;color:black;background-color:#dddddd;font-weight: bold;">
                                        تاريخ الفاتورة
                                    </td>
                                </tr>
                            </table>
                        </div>


                       <!-- Seller Info -->
                        <div class="row mt32 mb32" style="font-size: 15pt;margin-top:-15pt; margin-right:0pt;">
                        <div class="col-6">
                            <center>
                                <span class="text-center !important arabic" style="font-weight: bold;">معلومات البائع</span>
                            </center>
                            <table style="border: 2pt solid black; width:100%;" class="table table-bordered table-sm">
                                <tr style="border: 2pt solid black;">
                                    <td class="text-center arabic">
                                        <span t-field="o.company_id.name"/>
                                    </td>
                                    <td class="arabic" style="text-align:right;color:black;background-color:#dddddd;">
                                        الاسم
                                    </td>
                                </tr>
                                <tr style="border: 2pt solid black;">
                                    <td class="text-center arabic">
                                        <span t-field="o.company_id.street"/>- <span t-field="o.company_id.street2"/> - <span t-field="o.company_id.city"/> - <span t-field="o.company_id.country_id.name"/>
                                    </td>
                                    <td class="arabic" style="text-align:right;color:black;background-color:#dddddd;">
                                        العنوان
                                    </td>
                                </tr>
                                <tr style="border: 2pt solid black;">
                                    <td class="text-center arabic">
                                        <span t-field="o.company_id.vat"/>
                                    </td>
                                    <td class="arabic" style="text-align:right;color:black;background-color:#dddddd;">
                                        الرقم الضريبي
                                    </td>
                                </tr>
                                <tr style="border: 2pt solid black;">
                                    <td class="text-center arabic">
                                        <span t-field="o.company_id.company_registry"/>
                                    </td>
                                    <td class="arabic" style="text-align:right;color:black;background-color:#dddddd;">
                                        السجل التجاري
                                    </td>
                                </tr>
                            </table>
                        </div>

                            <!-- Customer Info -->
                                <div class="col-6">
                                    <center>
                                        <span class="arabic" style="font-weight: bold;text-align:center !important;">معلومات
                                            المستفيد</span>
                                    </center>
                                    <table style="border: 2pt solid black; width:100%;" class="table table-bordered table-sm">
                                        <tr style="border: 2pt solid black;">
                                            <td class="text-center arabic">
                                                <span t-field="o.partner_id.name"/>
                                            </td>
                                            <td class="arabic" style="text-align:right;color:black;background-color:#dddddd;">
                                                الاسم
                                            </td>
                                        </tr>
                                        <tr style="border: 2pt solid black;">
                                            <td class="text-center arabic">
                                                <span t-field="o.partner_id.street"/> - <span t-field="o.partner_id.city"/> - <span t-field="o.partner_id.country_id.name"/>
                                            </td>
                                            <td class="arabic" style="text-align:right;color:black;background-color:#dddddd;">
                                                العنوان
                                            </td>
                                        </tr>
                                        <tr style="border: 2pt solid black;">
                                            <td class="text-center arabic">
                                                <span t-field="o.partner_id.vat"/>
                                            </td>
                                            <td class="arabic" style="text-align:right;color:black;background-color:#dddddd;">
                                                الرقم الضريبي
                                            </td>
                                        </tr>
                                        <tr style="border: 2pt solid black;">
                                            <td class="text-center arabic">
                                                <span t-field="o.partner_id.buyer_identification_no"/>
                                            </td>
                                            <td class="arabic" style="text-align:right;color:black;background-color:#dddddd;">
                                                السجل التجاري
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        <br/>

                        <!-- Invoice Items -->
                        <table style="font-weight: bold;font-size: 15pt;border: 2pt solid black; width:100%; color:black;" class="table table-striped" dir="rtl">
                            <thead style="display: table-row-group">
                                <tr style="background-color: #dddddd; color: black; ">
                                    <td style="border: 2pt solid black; text-align: center; padding: 2pt;">
                                        <span class="arabic">#</span>
                                    </td>
                                    <td width="25%" style="border: 2pt solid black; text-align: center; padding: 2pt;">
                                        <span class="arabic">الاسم</span>
                                    </td>
                                    <td style="border: 2pt solid black; text-align: center; padding: 2pt;">
                                        <span class="arabic">سعر</span>
                                    </td>
                                    <td style="border: 2pt solid black; text-align: center; padding: 2pt;">
                                        <span class="arabic">الكمية</span>
                                    </td>
                                    <td style="border: 2pt solid black; text-align: center; padding: 2pt;">
                                        <span class="arabic">الوحدة</span>
                                    </td>
                                    
                                    <td style="border: 2pt solid black; text-align: center; padding: 2pt;">
                                        <span class="arabic">مبلغ الضريبة</span>
                                    </td>
                                    <td style="border: 2pt solid black; text-align: center; padding: 2pt;">
                                        <span class="arabic">المجموع غير شامل الضريبة</span>
                                    </td>
                                    <td style="border: 2pt solid black; text-align: center; padding: 2pt;">
                                        <span class="arabic">المجموع شامل الضريبة</span>
                                    </td>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="count" t-value="1"/>
                                <t t-set="discount_total" t-value="0"/>
                                <t t-set="tax_total" t-value="0"/>
                                <tr t-foreach="o.invoice_line_ids" t-as="l">
                                    <t t-set="line_tax_total" t-value="0"/>
                                    <t t-foreach="l.tax_ids" t-as="t">
                                        <t t-set="tax_total" t-value="tax_total + l.price_subtotal* t.amount/100"/>
                                        <t t-set="line_tax_total" t-value="line_tax_total + t.amount"/>
                                    </t>
                                    <td style="border: 2pt solid black; padding: 3pt; text-align: center;">
                                        <span class="arabic" t-esc="count"/>
                                    </td>
                                    <td style="border: 2pt solid black; padding: 3pt; text-align: center;">
                                        <span class="arabic" t-field="l.name"/>
                                    </td>
                                    <td style="border: 2pt solid black; padding: 3pt; text-align: center;">
                                        <span t-field="l.price_unit" />
                                    </td>
                                    <td style="border: 2pt solid black; padding: 3pt; text-align: center;">
                                        <span t-esc="'%.2f'%(l.quantity)"/>
                                    </td>
                                    <td style="border: 2pt solid black; padding: 3pt; text-align: center;">
                                        <span t-field="l.uom_name"/>
                                    </td>
                                   
                                    <td style="border: 2pt solid black; padding: 3pt; text-align: center;">
                                        <t t-set="line_tax_total" t-value="l.price_subtotal * l.tax_ids[0].amount / 100"/>
                                        <span t-esc="'%.2f'%(line_tax_total)"/> 
                                    </td>
                                    <td style="border: 2pt solid black; padding: 3pt; text-align: center;">
                                        <span t-esc="'%.2f'%(l.price_subtotal)"/>
                                    </td>
                                    <td style="border: 2pt solid black; padding: 3pt; text-align: center;">
                                        <span t-esc="'%.2f'%(l.price_total)"/>
                                    </td>
                                    <t t-set="count" t-value="count + 1"/>
                                </tr>
                            </tbody>
                        </table>
                        <br/>

                        <!-- Total Information -->
                        <table style="font-size: 17pt;border: 2pt solid black; width:100%; color:black;" class="table table-bordered table-sm" dir="rtl">
                            <thead>
                                <center>
                                    <span class="arabic" style="font-size: 17pt;font-weight: bold;">المبالغ
                                        الإجمالية</span>
                                </center>
                                <t t-set="discount_before_total" t-value="o.amount_untaxed + discount_total"/>

                                <tr style="border: 2pt solid black;">
                                    <td class="text-left arabic" style="border: 2pt solid black; text-align:right;padding:3pt; font-weight: bold;">
                                        إجمالي المبلغ قبل الضريبة
                                    </td>
                                    <td style="border: 2pt solid black; text-align:center;padding:3pt;font-weight: bold;" class="text-center">
                                        <span t-esc="'%.2f'%(o.amount_untaxed)"/>
                                    </td>
                                    <td class="text-left arabic" style="border: 2pt solid black; text-align:left;padding:3pt; font-weight: bold;">
                                        Total Amount Before Tax
                                    </td>
                                </tr>
                                <tr style="border: 2pt solid black;">
                                    <td class="text-left arabic" style="border: 2pt solid black; text-align:right;padding:3pt; font-weight: bold;">
                                        إجمالي ضريبة القيمة المضافة
                                    </td>
                                    <td style="border: 2pt solid black; text-align:center;padding:3pt;font-weight: bold;" class="text-center">
                                        <span t-esc="'%.2f'%(tax_total)"/>
                                    </td>
                                    <td class="text-left arabic" style="border: 2pt solid black; text-align:left;padding:3pt; font-weight: bold;">
                                        Total VAT 15%
                                    </td>
                                </tr>
                                <tr style="border: 2pt solid black;">
                                    <td class="text-left arabic" style="border: 2pt solid black; text-align:right;padding:3pt; font-weight: bold;">
                                        إجمالي المبلغ بعد الضريبة
                                    </td>
                                    <td style="border: 2pt solid black; text-align:center;padding:3pt;font-weight: bold;" class="text-center">
                                        <span t-esc="'%.2f'%(discount_before_total)"/> 
                                    </td>
                                    <td class="text-left arabic" style="border: 2pt solid black; text-align:left;padding:3pt; font-weight: bold;">
                                        Total Amount After Tax
                                    </td>
                                </tr>
                                <tr style="border: 2pt solid black;">
                                    <td class="text-left arabic" style="border: 2pt solid black; text-align:right;padding:3pt; background-color:#dddddd;color:black; font-weight: bold;">
                                        إجمالي المبلغ المستحق
                                    </td>
                                    <td style="border: 2pt solid black; text-align:center;padding:3pt; background-color:#dddddd;color:black; font-weight: bold;" class="text-center">
                                        <span t-field="o.amount_residual" />
                                    </td>
                                    <td class="text-left arabic" style="border: 2pt solid black; text-align:left;padding:3pt; background-color:#dddddd;color:black; font-weight: bold;">
                                        TOTAL AMOUNT DUE
                                    </td>
                                </tr>
                            </thead>
                        </table>

                        <table style="font-size: 17pt;font-weight: bold;border: 1pt solid grey; width:100%; color:black; margin-top: 0pt;" class="table table-bordered table-sm">
                            <thead>
                                <tr>
                                    <td class="text-right arabic" width="70%" style="padding-right:12px;">
                                        <span t-esc="o.amount_word(o.amount_total)"/>
                                    </td>
                                    <td class="text-right arabic" width="30%" style="font-weight: bold;background-color:#DCDCDC;">
                                        المبالغ المفوترة
                                    </td>
                                </tr>
                            </thead>
                        </table>
                        <!-- QR Code -->
                        <br/>
                          <br/>
                        <center>
                        <div class="col-3" style="margin-top:5pt; padding-left:25pt;">
                            <img t-if="o.get_qr_code()" style="border: 3px solid #dddddd; padding: 3px; display:block;margin-left:20px;" t-att-src="'/report/barcode/?barcode_type=%s&amp;value=%s&amp;width=%s&amp;height=%s'%('QR', o.get_qr_code(), 200, 200)"/>
                        </div>
                    </center>
                    </div>
                </div>
            </t>
        </t>
    </template>
</odoo>